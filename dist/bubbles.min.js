!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.bubbles=e():t.bubbles=e()}(window,(function(){return function(t){var e={};function i(s){if(e[s])return e[s].exports;var r=e[s]={i:s,l:!1,exports:{}};return t[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(s,r,function(e){return t[e]}.bind(null,r));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);const s=t=>t.replace(/(_\w)/g,t=>t[1].toUpperCase()),r=(t,e)=>Math.random()*(e-t)+t;class n{constructor(){this.currentFrame=0,this.lifetime=30,this.interpolation="linear",this.x=0,this.xSpeed=0,this._xSpeedPoints=null,this.xAcceleration=0,this._xAccelerationPoints=null,this.y=0,this.ySpeed=0,this._ySpeedPoints=null,this.yAcceleration=0,this._yAccelerationPoints=null,this.scale=1,this._scalePoints=null,this.opacity=1,this._opacityPoints=null,this.rotation=0,this._rotationPoints=null,this.shape="square",this.colourise=!1,this.red=255,this._redPoints=null,this.green=255,this._greenPoints=null,this.blue=255,this._bluePoints=null}update(t){this.xAcceleration+=this._interpolate(this._xAccelerationPoints),this.yAcceleration+=this._interpolate(this._yAccelerationPoints),this.xSpeed+=this._interpolate(this._xSpeedPoints)+this.xAcceleration,this.ySpeed+=this._interpolate(this._ySpeedPoints)+this.yAcceleration,this.x+=this.xSpeed*t,this.y+=this.ySpeed*t,this.scale+=this._interpolate(this._scalePoints),this.opacity+=this._interpolate(this._opacityPoints),this.rotation+=this._interpolate(this._rotationPoints),this.red+=this._interpolate(this._redPoints),this.green+=this._interpolate(this._greenPoints),this.blue+=this._interpolate(this._bluePoints),this.currentFrame++}isDead(){return this.currentFrame>this.lifetime}_interpolate(t){if(null===t)return 0;const e=~~(this.lifetime/(t.length-1)),i=~~(this.currentFrame/e),s=t[i],r=i+1<t.length?t[i+1]:t[i],n=i*e,a=(i+1)*e;return this["_"+this.interpolation+"Interpolate"](s,r,n,a)}_linearInterpolate(t,e,i,s){return(e-t)/(s-i)}_cosineInterpolate(t,e,i,s){return(e-t)/(s-i)*(Math.PI/2)*Math.sin(Math.PI*(this.currentFrame-i)/(s-i))}static loadFromObject(t){const e=new n;for(const i of Object.keys(t)){const r=s(i);r in e&&(t[i]instanceof Array&&t[i].length>1?(e[r]=t[i][0],e["_"+r+"Points"]=t[i]):e[r]=t[i])}return e}}class a{constructor(){this.particleSettings={},this.particleVariation={lifetime:0,xSpeed:0,ySpeed:0,xAcceleration:0,yAcceleration:0,scale:0,opacity:0,rotation:0,red:0,green:0,blue:0},this.particles=new Set,this.x=0,this.y=0,this.width=0,this.height=0,this.spawns=-1,this._currentSpawn=0,this.frames=30,this._currentFrame=0,this.maxParticles=1e3,this.spawnAmount=10}update(){0===this._currentFrame&&this._spawnBatch(),this._currentFrame++,this._currentFrame%=this.frames}isDead(){return-1!=this.spawns&&this._currentSpawn>this.spawns&&0==this.particles.size}reset(){this._currentSpawn=0}_spawnParticle(){const t={};for(const[e,i]of Object.entries(this.particleSettings))e in this.particleVariation?t[e]=i instanceof Array?i.map((t,i)=>r(t-this.particleVariation[e][i],t+this.particleVariation[e][i])):r(i-this.particleVariation[e],i+this.particleVariation[e]):t[e]=i;return t.x=r(this.x,this.x+this.width),t.y=r(this.y,this.y+this.height),n.loadFromObject(t)}_spawnBatch(){if(-1!=this.spawns&&this._currentSpawn++,this._currentSpawn<=this.spawns||-1===this.spawns){let t;for(t=0;t<this.spawnAmount;t++)this.particles.size<this.maxParticles&&this.particles.add(this._spawnParticle())}}static loadFromObject(t){const e=new a;for(const i of Object.keys(t)){const r=s(i);r in e&&(e[r]=t[i])}return e}}class o{constructor(){this._emitters=new Set,this._deadEmitters=new Set,this.x=0,this.xSpeed=0,this.y=0,this.ySpeed=0,this.loops=-1,this._currentLoop=1}update(t=1){this.x+=this.xSpeed*t,this.y+=this.ySpeed*t,this._emitters.forEach(e=>{e.update(),e.isDead()&&this._deadEmitters.add(e);const i=new Set;e.particles.forEach(e=>{e.update(t),e.x-=this.xSpeed*t,e.y-=this.ySpeed*t,e.isDead()&&i.add(e)}),i.forEach(t=>{e.particles.delete(t)})}),this._deadEmitters.size==this._emitters.size&&(this._currentLoop<this.loops||-1===this.loops)&&(this._deadEmitters.forEach(t=>{t.reset()}),-1!=this.loops&&this._currentLoop++,this._deadEmitters.clear())}addEmitter(...t){return t.forEach(t=>{this._emitters.add(t)}),this}getEmitters(){return this._emitters}setPos(t,e){return this.x=t,this.y=e,this}isDead(){return this.current_loops>this.loops!=-1&&this._emitters.size}static loadFromObject(t){const e=new o;for(const i of Object.keys(t)){const r=s(i);if("emitters"===i)for(const i of t.emitters)e.addEmitter(a.loadFromObject(i));else r in e&&(e[r]=t[i])}return e}}class h{constructor(t=32){this.baseSize=t}renderEffect(t,e){const i=e.getContext("2d");t.getEmitters().forEach(e=>{e.particles.forEach(e=>{const s={x:t.x+e.x-this.baseSize*e.scale/2,y:t.y+e.y-this.baseSize*e.scale/2};var r;this["_render"+(r=e.shape,r[0].toUpperCase()+r.substring(1).toLowerCase())](e,i,s)})})}_renderCircle(t,e,i){const s=t.scale*this.baseSize/2;s>0&&(e.beginPath(),e.fillStyle=`rgba( ${t.red}, ${t.green}, ${t.blue}, ${t.opacity})`,e.arc(i.x,i.y,s,0,2*Math.PI,!1),e.fill())}_renderSquare(t,e,i){e.fillStyle=`rgba( ${t.red}, ${t.green}, ${t.blue}, ${t.opacity})`,e.setTransform(1,0,0,1,i.x,i.y),e.rotate(t.rotation*Math.PI/180),e.fillRect(t.scale*this.baseSize/2,t.scale*this.baseSize/2,t.scale*this.baseSize,t.scale*this.baseSize),e.setTransform(1,0,0,1,0,0)}}window.Bubbles=class{constructor(t,e=32){this.renderer=new h(e),this.canvas=document.querySelector(t),this.particleEffects=[],this.update=this.update.bind(this),this.update()}registerEffect(t){return this.particleEffects.push(o.loadFromObject(t)),this}update(){this.canvas.getContext("2d").clearRect(0,0,this.canvas.width,this.canvas.height);for(const t of this.particleEffects)t.update(),this.renderer.renderEffect(t,this.canvas);requestAnimationFrame(this.update)}}}])}));